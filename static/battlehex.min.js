let cardset="./static/cards",player=1,computer=player%2+1,svgNS="http://www.w3.org/2000/svg",svgID="svgBoard",indexValues=["a","2","3","4","5","6","7","8","9","10","j","q","k"],playerFlipCard=null,playerPlayCard=null,computerFlipCard=null,computerPlayCard=null,playerSuits="s,d".split(","),computerSuits="c,h".split(","),deleteLine=null,gameBoard=[],voltageBoardIndexes=[],testVoltage=100,randomMoveLimit=1e3,loaderTimeout=50;function supportsSVG(){return!!document.createElementNS&&!!document.createElementNS(svgNS,"svg").createSVGRect}function getXCoord(e,l){return 160+10.2433112276*(l-e)}function getYCoord(e,l){return 62.0967741935+17.7419354839*(l-e)+35.4838709677*(e-1)}function makeCardMove(e,l){let t=!0;if(gameBoard.length!=indexValues.length+2)t=!1;else for(let e=0;e<indexValues.length+2||!t;e++)gameBoard[e].length!=indexValues.length+2&&(t=!1);if(t){if(l==player){if(document.getElementById(e).src!=cardset+"/back.svg"&&(null==playerFlipCard||null!=playerPlayCard||null==playerPlayCard&&e.substr(0,1).toLowerCase()!=playerFlipCard.substr(0,1).toLowerCase())){if(null==playerFlipCard)playerFlipCard=e;else if(null==playerPlayCard){let l=getPlayerRowColumn(playerFlipCard,e);l.row&&l.column&&null==gameBoard[l.row][l.column]&&(playerPlayCard=e)}else{let l=getPlayerRowColumn(playerFlipCard,playerPlayCard);drawHexCell(l.row,l.column,"makeCellMove("+l.row+","+l.column+",player);"),playerFlipCard=e,playerPlayCard=null}displayMove()}null!=playerFlipCard&&null!=playerPlayCard?(document.getElementById("randomizeFlipInput").checked&&(randomizeMove(player),document.getElementById("playerFlipCardImg").src=document.getElementById(playerFlipCard).src,document.getElementById("playerPlayCardImg").src=document.getElementById(playerPlayCard).src),document.getElementById("sendMove").disabled=!1):document.getElementById("sendMove").disabled=!0}else null==computerFlipCard?computerFlipCard=e:null==computerPlayCard?computerPlayCard=e:(computerFlipCard=e,computerPlayCard=null);null==playerPlayCard&&null==playerFlipCard||(document.getElementById("opponentPlayCardImg").src=cardset+"/back.svg",document.getElementById("opponentFlipCardImg").src=cardset+"/back.svg")}}function makeCellMove(e,l,t){evaluateWin(player,gameBoard)||evaluateWin(computer,gameBoard)||(t==player?(null==playerPlayCard&&null!=playerFlipCard&&("r"==deleteLine.substr(0,1)?makeCardMove("b"+indexValues[l-1],t):"c"==deleteLine.substr(0,1)&&makeCardMove("r"+indexValues[e-1],t)),makeCardMove("r"+indexValues[e-1],t),makeCardMove("b"+indexValues[l-1],t)):(makeCardMove("r"+indexValues[e-1],t),makeCardMove("b"+indexValues[l-1],t),randomizeMove(t)))}function randomizeMove(e){if(e==player){if(null!=playerFlipCard&&null!=playerPlayCard){if(Math.random()<.5){var l=playerFlipCard;playerFlipCard=playerPlayCard,playerPlayCard=l}document.getElementById("playerFlipCardImg").src=cardset+"/"+playerSuits["b,r".split(",").indexOf(playerFlipCard.substr(0,1))]+playerFlipCard.substr(1)+".svg",document.getElementById("playerPlayCardImg").src=cardset+"/"+playerSuits["b,r".split(",").indexOf(playerPlayCard.substr(0,1))]+playerPlayCard.substr(1)+".svg"}}else if(Math.random()<.5){l=computerFlipCard;computerFlipCard=computerPlayCard,computerPlayCard=l}}function showMoves(){let e=getPlayerRowColumn(playerFlipCard,playerPlayCard),l=getPlayerRowColumn(computerFlipCard,computerPlayCard);if(null!=playerFlipCard&&null!=playerPlayCard&&null!=computerFlipCard&&null!=computerPlayCard)document.getElementById("opponentFlipCardImg").src=cardset+"/"+computerSuits["b,r".split(",").indexOf(computerFlipCard.substr(0,1))]+computerFlipCard.substr(1)+".svg",document.getElementById("opponentPlayCardImg").src=cardset+"/"+computerSuits["b,r".split(",").indexOf(computerPlayCard.substr(0,1))]+computerPlayCard.substr(1)+".svg",e.row==l.row&&e.column==l.column?tieBreaker():(1==player?(gameBoard[e.row][e.column]=player,drawHexPiece(e.row,e.column,"red"),gameBoard[l.row][l.column]=computer,drawHexPiece(l.row,l.column,"black")):(gameBoard[e.row][e.column]=player,drawHexPiece(e.row,e.column,"black"),gameBoard[l.row][l.column]=computer,drawHexPiece(l.row,l.column,"red")),playerFlipCard=null,playerPlayCard=null,computerFlipCard=null,computerPlayCard=null,evaluateWin(player,gameBoard)||evaluateWin(computer,gameBoard)||(document.getElementById("loader").classList.add("loaderanimation"),setTimeout((function(){l=calculateComputerMove(computer,gameBoard),makeCellMove(l.row,l.column,computer),showMoves(),document.getElementById("loader").classList.remove("loaderanimation")}),loaderTimeout))),evaluateWin(player,gameBoard)?alert("Player wins!"):evaluateWin(computer,gameBoard)&&alert("Computer wins!");else{let t=0,a=0;for(let e=1;e<=indexValues.length;e++)for(let l=1;l<=indexValues.length;l++)gameBoard[e][l]==player?t++:gameBoard[e][l]==computer&&a++;t<a&&null!=playerFlipCard&&null!=playerPlayCard&&("r"==computerFlipCard.substr(0,1)?(makeCardMove("r"+indexValues[e.row-1],player),makeCardMove("b"+indexValues[e.column-1],player)):(makeCardMove("b"+indexValues[e.column-1],player),makeCardMove("r"+indexValues[e.row-1],player)),1==player?(gameBoard[e.row][e.column]=player,drawHexPiece(e.row,e.column,"red")):(gameBoard[e.row][e.column]=player,drawHexPiece(e.row,e.column,"black")),playerFlipCard=null,playerPlayCard=null,computerFlipCard=null,computerPlayCard=null,document.getElementById("loader").classList.add("loaderanimation"),setTimeout((function(){l=calculateComputerMove(computer,gameBoard),makeCellMove(l.row,l.column,computer),showMoves(),document.getElementById("loader").classList.remove("loaderanimation")}),loaderTimeout))}blankFullLines()}function blankFullLines(){for(let e=1;e<=indexValues.length;e++){let l=!1;for(let t=1;t<=indexValues.length;t++)null==gameBoard[e][t]&&(l=!0);l||(document.getElementById("r"+indexValues[e-1]).src=cardset+"/back.svg",document.getElementById("r"+indexValues[e-1]).onclick=""),l=!1;for(let t=1;t<=indexValues.length;t++)null==gameBoard[t][e]&&(l=!0);l||(document.getElementById("b"+indexValues[e-1]).src=cardset+"/back.svg",document.getElementById("b"+indexValues[e-1]).onclick="")}}function resetCardFaces(){for(let e=0;e<indexValues.length;e++){let l=!1;for(let t=1;t<=indexValues.length;t++)null==gameBoard[e+1][t]&&(l=!0);l?(document.getElementById("r"+indexValues[e]).src=cardset+"/"+playerSuits.join(",").substr("b,r".indexOf("r"),1)+indexValues[e]+".svg",document.getElementById("r"+indexValues[e]).setAttribute("onclick","makeCardMove('r"+indexValues[e]+"', player);")):(document.getElementById("r"+indexValues[e]).src=cardset+"/back.svg",document.getElementById("r"+indexValues[e]).setAttribute("onclick","")),l=!1;for(let t=1;t<=indexValues.length;t++)null==gameBoard[t][e+1]&&(l=!0);l?(document.getElementById("b"+indexValues[e]).src=cardset+"/"+playerSuits.join(",").substr("b,r".indexOf("b"),1)+indexValues[e]+".svg",document.getElementById("b"+indexValues[e]).setAttribute("onclick","makeCardMove('b"+indexValues[e]+"', player);")):(document.getElementById("b"+indexValues[e]).src=cardset+"/back.svg",document.getElementById("b"+indexValues[e]).setAttribute("onclick",""))}}function tieBreaker(){if(null!=playerFlipCard&&null!=playerPlayCard&&null!=computerFlipCard&&null!=computerPlayCard){let e=getPlayerRowColumn(playerFlipCard,playerPlayCard);if(playerFlipCard==computerFlipCard)if(1==player){let l={};alert('Both move to "'+playerFlipCard+'", "'+playerPlayCard+'."  Player wins move.'),gameBoard[e.row][e.column]=player,drawHexPiece(e.row,e.column,"red"),evaluateWin(player,gameBoard)||(document.getElementById("loader").classList.add("loaderanimation"),setTimeout((function(){l=calculateComputerMove(computer,gameBoard),gameBoard[l.row][l.column]=computer,drawHexPiece(l.row,l.column,"black"),"r"==playerFlipCard.substr(0,1)?(makeCardMove("r"+indexValues[l.row-1],computer),makeCardMove("b"+indexValues[l.column-1],computer)):(makeCardMove("b"+indexValues[l.column-1],computer),makeCardMove("r"+indexValues[l.row-1],computer)),playerFlipCard=null,playerPlayCard=null,document.getElementById("opponentFlipCardImg").src=cardset+"/"+computerSuits["b,r".split(",").indexOf(computerFlipCard.substr(0,1))]+computerFlipCard.substr(1)+".svg",document.getElementById("opponentPlayCardImg").src=cardset+"/"+computerSuits["b,r".split(",").indexOf(computerPlayCard.substr(0,1))]+computerPlayCard.substr(1)+".svg",l=calculateComputerMove(player,gameBoard),makeCellMove(l.row,l.column,computer),document.getElementById("loader").classList.remove("loaderanimation")}),loaderTimeout))}else{alert('Both move to "'+computerFlipCard+'", "'+computerPlayCard+'."  Computer wins move.');let e=getPlayerRowColumn(computerFlipCard,computerPlayCard);playerFlipCard=null,playerPlayCard=null,gameBoard[e.row][e.column]=computer,drawHexPiece(e.row,e.column,"red")}else if(2==player){alert('Both move to "'+playerFlipCard+'", "'+playerPlayCard+'."  Player wins move.');let l={};gameBoard[e.row][e.column]=player,drawHexPiece(e.row,e.column,"black"),evaluateWin(player,gameBoard)||(document.getElementById("loader").classList.add("loaderanimation"),setTimeout((function(){l=calculateComputerMove(computer,gameBoard),gameBoard[l.row][l.column]=computer,drawHexPiece(l.row,l.column,"red"),"r"==playerFlipCard.substr(0,1)?(makeCardMove("r"+indexValues[l.row-1],computer),makeCardMove("b"+indexValues[l.column-1],computer)):(makeCardMove("b"+indexValues[l.column-1],computer),makeCardMove("r"+indexValues[l.row-1],computer)),playerFlipCard=null,playerPlayCard=null,document.getElementById("opponentFlipCardImg").src=cardset+"/"+computerSuits["b,r".split(",").indexOf(computerFlipCard.substr(0,1))]+computerFlipCard.substr(1)+".svg",document.getElementById("opponentPlayCardImg").src=cardset+"/"+computerSuits["b,r".split(",").indexOf(computerPlayCard.substr(0,1))]+computerPlayCard.substr(1)+".svg",l=calculateComputerMove(player,gameBoard),makeCellMove(l.row,l.column,computer),document.getElementById("loader").classList.remove("loaderanimation")}),loaderTimeout))}else{alert('Both move to "'+computerFlipCard+'", "'+computerPlayCard+'."  Computer wins move.');let e=getPlayerRowColumn(computerFlipCard,computerPlayCard);playerFlipCard=null,playerPlayCard=null,gameBoard[e.row][e.column]=computer,drawHexPiece(e.row,e.column,"black")}}}function evaluateWin(e,l){let t=[function(){return n<indexValues.length+1&&[0,3,e].indexOf(l[r][n+1])>=0},function(){return r<indexValues.length+1&&[0,3,e].indexOf(l[r+1][n])>=0},function(){return r<indexValues.length+1&&n>0&&[0,3,e].indexOf(l[r+1][n-1])>=0},function(){return n>0&&[0,3,e].indexOf(l[r][n-1])>=0},function(){return r>0&&[0,3,e].indexOf(l[r-1][n])>=0},function(){return r>0&&n<indexValues.length+1&&[0,3,e].indexOf(l[r-1][n+1])>=0}],a=[function(){n++},function(){r++},function(){r++,n--},function(){n--},function(){r--},function(){r--,n++}],o=null,r=null,n=null;if((1==e||2==e)&&(o=0,r=0,n=0),1==e)for(;!t[o]()&&t[(o+1)%6]()?(o=(o+1)%6,a[o](),o=(o+4)%6):o=t[o]()&&!t[(o+1)%6]()||t[o]()&&t[(o+1)%6]()?(o+5)%6:(t[o]()||t[(o+1)%6](),(o+1)%6),0!=l[r][n];);else if(2==e)for(;t[o]()&&!t[(o+1)%6]()?a[o]():o=!t[o]()&&t[(o+1)%6]()||t[o]()&&t[(o+1)%6]()?(o+1)%6:(t[o]()||t[(o+1)%6](),(o+5)%6),0!=l[r][n];);return 1==e&&n>=indexValues.length+1||2==e&&r>=indexValues.length+1}function sendPlayerMove(){showMoves()}function drawHexPiece(e,l,t,a){drawSVGPiece(e,l,t,a)}function drawHexCell(e,l,t){drawSVGCell(e,l,t)}function getPlayerRowColumn(e,l){let t={row:null,column:null};return e&&(1=="br".indexOf(e.substr(0,1).toLowerCase())?t.row=indexValues.indexOf(e.substr(1))+1:t.column=indexValues.indexOf(e.substr(1))+1),l&&(1=="br".indexOf(l.substr(0,1).toLowerCase())?t.row=indexValues.indexOf(l.substr(1))+1:t.column=indexValues.indexOf(l.substr(1))+1),t}function displayMove(){let e=getPlayerRowColumn(playerFlipCard,playerPlayCard);if(null==playerPlayCard){document.getElementById("playerFlipCardImg").src=document.getElementById(playerFlipCard).src,document.getElementById("playerPlayCardImg").src=cardset+"/blank.svg";for(let e=0;e<indexValues.length;e++)document.getElementById(playerFlipCard.substr(0,1).toLowerCase()+indexValues[e]).src=cardset+"/back.svg"}else document.getElementById("playerPlayCardImg").src=document.getElementById(playerPlayCard).src,resetCardFaces();if(null!=playerFlipCard&&null==playerPlayCard){if(null!=e.row){deleteLine="r"+e.row;for(let l=1;l<=indexValues.length;l++)null==gameBoard[e.row][l]?(drawHexCell(e.row,l,null),drawHexPiece(e.row,l,"cyan","makeCellMove("+e.row+","+l+",player);")):(document.getElementById("b"+indexValues[l-1]).src=cardset+"/back.svg",document.getElementById("b"+indexValues[l-1]).onclick="")}else if(null!=e.column){deleteLine="b"+e.column;for(let l=1;l<=indexValues.length;l++)null==gameBoard[l][e.column]?(drawHexCell(l,e.column,null),drawHexPiece(l,e.column,"cyan","makeCellMove("+l+","+e.column+",player);")):(document.getElementById("r"+indexValues[l-1]).src=cardset+"/back.svg",document.getElementById("r"+indexValues[l-1]).onclick="")}}else if(null!=playerFlipCard&&null!=playerPlayCard){document.getElementById("playerFlipCardImg").src=cardset+"/"+playerSuits["b,r".split(",").indexOf(playerFlipCard.substr(0,1))]+playerFlipCard.substr(1)+".svg",document.getElementById("playerPlayCardImg").src=cardset+"/"+playerSuits["b,r".split(",").indexOf(playerPlayCard.substr(0,1))]+playerPlayCard.substr(1)+".svg";for(let e=1;e<=indexValues.length;e++)if("r"==deleteLine.substr(0,1)){if(null==gameBoard[deleteLine.substr(1,deleteLine.length-1)][e]){let l=deleteLine.substr(1,deleteLine.length-1);drawHexCell(l,e,"makeCellMove("+l+","+e+",player);")}}else if("b"==deleteLine.substr(0,1)&&null==gameBoard[e][deleteLine.substr(1,deleteLine.length-1)]){let l=e,t=deleteLine.substr(1,deleteLine.length-1);drawHexCell(l,t,"makeCellMove("+l+","+t+",player);")}drawHexCell(e.row,e.column,null),drawHexPiece(e.row,e.column,"cyan","sendPlayerMove();")}}function svgHexCell(e,l,t){let a=document.createElementNS(svgNS,"polygon"),o="",r=getXCoord(e,l),n=getYCoord(e,l);return o+=r+10.243311227557877+","+(n+-5.913978494623655),o+=" ",o+=r+1e-15+","+(n+-11.827956989247312),o+=" ",o+=r+-10.243311227557875+","+(n+-5.91397849462366),o+=" ",o+=r+-10.243311227557879+","+(n+5.913978494623652),o+=" ",o+=r+-2e-15+","+(n+11.827956989247312),o+=" ",o+=r+10.243311227557879+","+(n+5.913978494623652),a.setAttribute("points",o),t&&a.setAttribute("onclick",t),a.style.fill="white",a.style.stroke="black",a}function svgHexPiece(e,l,t,a){let o=document.createElementNS(svgNS,"circle");return o.setAttribute("cx",getXCoord(e,l)),o.setAttribute("cy",getYCoord(e,l)),o.setAttribute("r",8.279569892473118),o.setAttribute("stroke","black"),o.setAttribute("fill",t),a&&o.setAttribute("onclick",a),o}function drawSVGPiece(e,l,t,a){document.getElementById(svgID).appendChild(svgHexPiece(e,l,t,a))}function drawSVGCell(e,l,t){document.getElementById(svgID).appendChild(svgHexCell(e,l,t))}function startGame(){voltageBoardIndexes=null,gameBoard=[],voltageBoardIndexes=[];let e=0,l=null;document.getElementById("playerPlayCardImg").src=cardset+"/blank.svg",document.getElementById("playerFlipCardImg").src=cardset+"/blank.svg",document.getElementById("opponentPlayCardImg").src=cardset+"/blank.svg",document.getElementById("opponentFlipCardImg").src=cardset+"/blank.svg";for(let l=0;l<=indexValues.length+1;l++){gameBoard.push([]),voltageBoardIndexes.push([]);for(let t=0;t<=indexValues.length+1;t++)0==l&&t==indexValues.length+1||l==indexValues.length+1&&0==t||0==l&&0==t||l==indexValues.length+1&&t==indexValues.length+1?gameBoard[l].push(0):0==l||l==indexValues.length+1?gameBoard[l].push(2):0==t||t==indexValues.length+1?gameBoard[l].push(1):(gameBoard[l].push(null),drawHexCell(l,t,"makeCellMove("+l+","+t+",player);")),voltageBoardIndexes[l].push(e++)}resetCardFaces(),playerFlipCard=null,playerPlayCard=null,computerFlipCard=null,computerPlayCard=null,document.getElementById("loader").classList.add("loaderanimation"),setTimeout((function(){l=calculateComputerMove(computer,gameBoard),makeCellMove(l.row,l.column,computer),showMoves(),document.getElementById("loader").classList.remove("loaderanimation")}),loaderTimeout)}function calculateComputerMove(e,l){let t=0,a=2,o={},r=[normalizeMoves(calculateMonteCarloMoves(e,l))[0],normalizeMoves(calculateVoltageMoves(e,l))[0],normalizeMoves(calculateSemiBestMoves(e,l))[0]];for(let o=0;o<r.length;o++)if(r[o]){let n=testUsingMonteCarlo(e,l,r[o].row,r[o].column);n>t&&(t=n,a=o)}return o={row:r[a].row,column:r[a].column},o}function normalizeMoves(e){let l=[],t=[];for(let l=0;l<e.length;l++)t.push(e[l].weight);for(let a=0;a<e.length;a++){let o={row:e[a].row,column:e[a].column,zscore:(e[a].weight-math.mean(t))/math.std(t)};l.push(o)}return l=l.sort((function(e,l){return l.zscore-e.zscore})),l}function calculateSemiBestMoves(e,l){let t=[],a=[null,calculateVoltages(1,l),calculateVoltages(2,l)];if(a[1].length&&a[2].length&&(t=getSemiBestMoves(e,l,calculateVoltageDeltas(a[1]),calculateVoltageDeltas(a[2]))),0==t.length){let e={row:7,column:7,weight:1};t.push(e)}return t}function testUsingMonteCarlo(e,l,t,a){let o=[],r=0,n=0,d=e%2+1;for(let e=0;e<l.length;e++)o.push(Object.assign([],l[e]));o[t][a]=e;let u=getEmptyCoords(o);for(;r<randomMoveLimit;){let l=randomizeBoardMoves(o,u,e),s=null,i=null;evaluateWin(e,l)?s=e:evaluateWin(d,l)&&(s=d),l[t][a]=d,evaluateWin(e,l)?i=e:evaluateWin(d,l)&&(i=d),s!=i&&n++,r++}return n/randomMoveLimit}function calculateMonteCarloMoves(e,l){let t=[],a=getEmptyCoords(l),o=[],r=e%2+1;for(let e=0;e<a.length;e++)o.push(0);let n=0;for(;n<randomMoveLimit;){let t=randomizeBoardMoves(l,a);for(let l=0;l<a.length;l++){let n=null,d=null;evaluateWin(e,t)?n=e:evaluateWin(r,t)&&(n=r),t[a[l][0]][a[l][1]]=t[a[l][0]][a[l][1]]%2+1,evaluateWin(e,t)?d=e:evaluateWin(r,t)&&(d=r),n!=d&&o[l]++}n++}for(let e=0;e<a.length;e++){let l={row:a[e][0],column:a[e][1],weight:o[e]};t.push(l)}return t}function getEmptyCoords(e){let l=[];for(let t=1;t<=indexValues.length;t++)for(let a=1;a<=indexValues.length;a++)null==e[t][a]&&l.push([t,a]);return l}function randomizeBoardMoves(e,l,t){let a=[],o=(Math.random(),2),r=[];t&&(o=t%2+1);for(let l=0;l<e.length;l++)a.push(Object.assign([],e[l]));r=Object.assign([],l);for(let e=r.length;e>0;e--){let l=Math.floor(Math.random()*e);a[r[l][0]][r[l][1]]=o,r.splice(l,1),o=o%2+1}return a}function calculateVoltageMoves(e,l){let t=[],a=[null,calculateVoltages(1,l),calculateVoltages(2,l)];return a[1].length&&a[2].length&&(t=evaluateMoves(e,l,calculateVoltageDeltas(a[1]),calculateVoltageDeltas(a[2]))),t}function resetVoltageSolutions(e){let l=[];for(let t=0;t<e.length;t++)for(let a=0;a<e[t].length;a++)l.push(0);return l}function resetVoltageBoards(e){let l=[];for(let t=0;t<e;t++){l.push([]);for(let a=0;a<e;a++)l[t].push(0)}return l}function calculateVoltages(e,l){let t=[],a=resetVoltageSolutions(l),o=resetVoltageBoards(a.length);for(let t=0;t<l.length;t++)for(let r=0;r<l[t].length;r++)if(!(0==t&&0==r||t==indexValues.length+1&&r==indexValues.length+1))if(0==t&&2==e)o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r]]=1,a[voltageBoardIndexes[t][r]]=testVoltage;else if(0==r&&1==e)o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r]]=1,a[voltageBoardIndexes[t][r]]=testVoltage;else if(0==t&&1==e)o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r]]=1,a[voltageBoardIndexes[t][r]]=0;else if(0==r&&2==e)o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r]]=1,a[voltageBoardIndexes[t][r]]=0;else if(t==l.length-1||r==l[t].length-1)o[e][voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r]]=1,a[voltageBoardIndexes[t][r]]=0;else{let n=0,d=0,u=-1;2==getVoltageRelationship(t,r,t-1,r,l,e)&&d++,2==getVoltageRelationship(t,r,t-1,r+1,l,e)&&d++,2==getVoltageRelationship(t,r,t,r-1,l,e)&&d++,2==getVoltageRelationship(t,r,t,r+1,l,e)&&d++,2==getVoltageRelationship(t,r,t+1,r-1,l,e)&&d++,2==getVoltageRelationship(t,r,t+1,r,l,e)&&d++,2==getVoltageRelationship(t,r,t-1,r,l,e)&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t-1][r]]=-2/d),2==getVoltageRelationship(t,r,t-1,r+1,l,e)&&o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t-1][r+1]],2==getVoltageRelationship(t,r,t,r-1,l,e)&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r-1]]=-2/d),2==getVoltageRelationship(t,r,t,r+1,l,e)&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r+1]]=-2/d),2==getVoltageRelationship(t,r,t+1,r-1,l,e)&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t+1][r-1]]=-2/d),2==getVoltageRelationship(t,r,t+1,r,l,e)&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t+1][r]]=-2/d),d&&(u=1),[1,3].indexOf(getVoltageRelationship(t,r,t-1,r,l,e))>-1&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t-1][r]]=u,n++),[1,3].indexOf(getVoltageRelationship(t,r,t-1,r+1,l,e))>-1&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t-1][r+1]]=u,n++),[1,3].indexOf(getVoltageRelationship(t,r,t,r-1,l,e))>-1&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r-1]]=u,n++),[1,3].indexOf(getVoltageRelationship(t,r,t,r+1,l,e))>-1&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r+1]]=u,n++),[1,3].indexOf(getVoltageRelationship(t,r,t+1,r-1,l,e))>-1&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t+1][r-1]]=u,n++),[1,3].indexOf(getVoltageRelationship(t,r,t+1,r,l,e))>-1&&(o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t+1][r]]=u,n++),o[voltageBoardIndexes[t][r]][voltageBoardIndexes[t][r]]=n,a[voltageBoardIndexes[t][r]]=0}try{let e=numeric.ccsSparse(o);t=numeric.ccsLUPSolve(numeric.ccsLUP(e),a)}catch(e){console.log(e)}return t}function getVoltageRelationship(e,l,t,a,o,r){return null==o[e][l]&&o[t][a]==r||o[e][l]==r&&null==o[t][a]||null==o[e][l]&&0==o[t][a]||0==o[e][l]&&null==o[t][a]?1:o[e][l]==r&&o[t][a]==r||0==o[e][l]&&o[t][a]==r||o[e][l]==r&&0==o[t][a]?2:null==o[e][l]&&null==o[t][a]?3:0}function calculateVoltageDeltas(e){let l=[];for(let t=0;t<e.length;t++){l.push([]);for(let a=0;a<e.length;a++)l[t].push(0)}for(let t=1;t<=indexValues.length;t++)for(let a=1;a<=indexValues.length;a++)l[voltageBoardIndexes[t][a]][voltageBoardIndexes[t-1][a]]=e[voltageBoardIndexes[t][a]]-e[voltageBoardIndexes[t-1][a]],l[voltageBoardIndexes[t][a]][voltageBoardIndexes[t-1][a+1]]=e[voltageBoardIndexes[t][a]]-e[voltageBoardIndexes[t-1][a+1]],l[voltageBoardIndexes[t][a]][voltageBoardIndexes[t][a-1]]=e[voltageBoardIndexes[t][a]]-e[voltageBoardIndexes[t][a-1]],l[voltageBoardIndexes[t][a]][voltageBoardIndexes[t][a+1]]=e[voltageBoardIndexes[t][a]]-e[voltageBoardIndexes[t][a+1]],l[voltageBoardIndexes[t][a]][voltageBoardIndexes[t+1][a-1]]=e[voltageBoardIndexes[t][a]]-e[voltageBoardIndexes[t+1][a-1]],l[voltageBoardIndexes[t][a]][voltageBoardIndexes[t+1][a]]=e[voltageBoardIndexes[t][a]]-e[voltageBoardIndexes[t+1][a]];return l}function evaluateMoveDeltas(e,l,t,a){let o=0;return[1,3].indexOf(getVoltageRelationship(e,l,e-1,l,gameBoard,t))>-1?o+=a[voltageBoardIndexes[e][l]][voltageBoardIndexes[e-1][l]]:[1,3].indexOf(getVoltageRelationship(e,l,e-1,l+1,gameBoard,t))>-1?o+=a[voltageBoardIndexes[e][l]][voltageBoardIndexes[e-1][l+1]]:[1,3].indexOf(getVoltageRelationship(e,l,e,l-1,gameBoard,t))>-1?o+=a[voltageBoardIndexes[e][l]][voltageBoardIndexes[e][l-1]]:[1,3].indexOf(getVoltageRelationship(e,l,e,l+1,gameBoard,t))>-1?o+=a[voltageBoardIndexes[e][l]][voltageBoardIndexes[e][l+1]]:[1,3].indexOf(getVoltageRelationship(e,l,e+1,l-1,gameBoard,t))>-1?o+=a[voltageBoardIndexes[e][l]][voltageBoardIndexes[e+1][l-1]]:[1,3].indexOf(getVoltageRelationship(e,l,e+1,l,gameBoard,t))>-1&&(o+=a[voltageBoardIndexes[e][l]][voltageBoardIndexes[e+1][l]]),o}function moveBordersOpponent(e,l,t,a){let o=!1,r=a%2+1;return 0>=e-1||t.length<=e+1||0>=l-1||t.length<=l+1?o=!1:(!getVoltageRelationship(e,l,e-1,l,t,a)&&getVoltageRelationship(e,l,e-1,l,t,r)||!getVoltageRelationship(e,l,e-1,l+1,t,a)&&getVoltageRelationship(e,l,e-1,l+1,t,r)||!getVoltageRelationship(e,l,e,l-1,t,a)&&getVoltageRelationship(e,l,e,l-1,t,r)||!getVoltageRelationship(e,l,e,l+1,t,a)&&getVoltageRelationship(e,l,e,l+1,t,r)||!getVoltageRelationship(e,l,e+1,l-1,t,a)&&getVoltageRelationship(e,l,e+1,l-1,t,r)||!getVoltageRelationship(e,l,e+1,l,t,a)&&getVoltageRelationship(e,l,e+1,l,t,r))&&(o=!0),o}function moveFitsOpponentDiamond(e,l,t,a){let o=!1,r=a%2+1;return 0>=e-2||t.length<=e+2||0>=l-2||t.length<=l+2?o=!1:(1==getVoltageRelationship(e,l,e+1,l+1,t,r)&&1==getVoltageRelationship(e,l,e+1,l,t,r)&&1==getVoltageRelationship(e,l,e,l+1,t,r)||1==getVoltageRelationship(e,l,e-1,l-1,t,r)&&1==getVoltageRelationship(e,l,e-1,l,t,r)&&1==getVoltageRelationship(e,l,e,l-1,t,r)||1==getVoltageRelationship(e,l,e-1,l+2,t,r)&&1==getVoltageRelationship(e,l,e,l+1,t,r)&&1==getVoltageRelationship(e,l,e-1,l+1,t,r)||1==getVoltageRelationship(e,l,e+1,l-2,t,r)&&1==getVoltageRelationship(e,l,e,l-1,t,r)&&1==getVoltageRelationship(e,l,e+1,l-1,t,r)||1==getVoltageRelationship(e,l,e+2,l-1,t,r)&&1==getVoltageRelationship(e,l,e+1,l,t,r)&&1==getVoltageRelationship(e,l,e+1,l-1,t,r)||1==getVoltageRelationship(e,l,e-2,l+1,t,r)&&1==getVoltageRelationship(e,l,e-1,l,t,r)&&1==getVoltageRelationship(e,l,e-1,l+1,t,r))&&(o=!0),o}function moveFitsEstablishedDiamond(e,l,t,a){let o=[];return 0>=e-2||t.length<=e+2||0>=l-2||t.length<=l+2?o=[]:2==getVoltageRelationship(e,l,e+1,l+1,t,a)&&1==getVoltageRelationship(e,l,e+1,l,t,a)&&1==getVoltageRelationship(e,l,e,l+1,t,a)?(o.push({row:e+1,column:l}),o.push({row:e,column:l+1})):2==getVoltageRelationship(e,l,e-1,l-1,t,a)&&1==getVoltageRelationship(e,l,e-1,l,t,a)&&1==getVoltageRelationship(e,l,e,l-1,t,a)?(o.push({row:e-1,column:l}),o.push({row:e,column:l-1})):2==getVoltageRelationship(e,l,e-1,l+2,t,a)&&1==getVoltageRelationship(e,l,e,l+1,t,a)&&1==getVoltageRelationship(e,l,e-1,l+1,t,a)?(o.push({row:e,column:l+1}),o.push({row:e-1,column:l+1})):2==getVoltageRelationship(e,l,e+1,l-2,t,a)&&1==getVoltageRelationship(e,l,e,l-1,t,a)&&1==getVoltageRelationship(e,l,e+1,l-1,t,a)?(o.push({row:e,column:l-1}),o.push({row:e+1,column:l-1})):2==getVoltageRelationship(e,l,e+2,l-1,t,a)&&1==getVoltageRelationship(e,l,e+1,l,t,a)&&1==getVoltageRelationship(e,l,e+1,l-1,t,a)?(o.push({row:e+1,column:l}),o.push({row:e+1,column:l-1})):2==getVoltageRelationship(e,l,e-2,l+1,t,a)&&1==getVoltageRelationship(e,l,e-1,l,t,a)&&1==getVoltageRelationship(e,l,e-1,l+1,t,a)&&(o.push({row:e-1,column:l}),o.push({row:e-1,column:l+1})),o}function moveAdvantageousOpponent(e,l,t,a){let o=!1;return(moveFitsOpponentDiamond(e,l,t,a)||moveBordersOpponent(e,l,t,a))&&(o=!0),o}function getDefensiveMoves(e,l,t,a){let o=e%2+1,r=[];if(!r.length)for(let e=0;e<l.length;e++)for(let n=0;n<l[e].length;n++)if(l[e][n]==o){let d=moveFitsEstablishedDiamond(e,n,l,o);if(d.length)for(let e=0;e<d.length;e+=2)null==l[d[e].row][d[e].column]&&null==l[d[e+1].row][d[e+1].column]&&(r.push({playerFactor:t[d[e].row][d[e].column],opponentFactor:a[d[e].row][d[e].column],normPlayerFactor:null,normOpponentFactor:null,weight:null,row:d[e].row+1,column:d[e].column+1}),r.push({playerFactor:t[d[e+1].row][d[e+1].column],opponentFactor:a[d[e+1].row][d[e+1].column],normPlayerFactor:null,normOpponentFactor:null,weight:null,row:d[e+1].row+1,column:d[e+1].column+1}))}for(let o=0;o<l.length;o++)for(let n=0;n<l[o].length;n++)null==l[o][n]&&moveAdvantageousOpponent(o,n,l,e)&&r.push({playerFactor:t[o][n],opponentFactor:a[o][n],normPlayerFactor:null,normOpponentFactor:null,weight:null,row:o+1,column:n+1});return r}function setupMovesReturn(e){let l=e,t=0,a=0,o=0,r=0,n=0,d=0,u=0;for(let e=0;e<l.length;e++)null!=l[e].playerFactor&&(t++,a+=l[e].playerFactor,o=o<l[e].playerFactor?l[e].playerFactor:o),null!=l[e].opponentFactor&&(r++,n+=l[e].opponentFactor,d=d<l[e].opponentFactor?l[e].opponentFactor:d);for(let e=0;e<l.length;e++)null!=l[e].playerFactor&&null!=l[e].opponentFactor&&(l[e].normPlayerFactor=l[e].playerFactor*t/a,l[e].normOpponentFactor=l[e].opponentFactor*r/n,l[e].weight=l[e].normPlayerFactor/l[e].normOpponentFactor,u+=l[e].weight),null==l[e].playerFactor&&(l[e].playerFactor=o),null==l[e].opponentFactor&&(l[e].opponentFactor=d),null==l[e].weight&&(l[e].weight=0);return l.sort((function(e,l){return e.weight-l.weight})),l}function evaluateMoves(e,l,t,a){let o=e%2+1,r=[],n=[],d=[],u=[],s=[],i=[],g=[];for(let s=1;s<=indexValues.length;s++){n.push([]),d.push([]),r.push([]);for(let c=1;c<=indexValues.length;c++)n[s-1].push(null),d[s-1].push(null),r[s-1].push(null),null==l[s][c]?(i.push(evaluateMoveDeltas(s,c,e,t)),g.push(evaluateMoveDeltas(s,c,o,a)),i[i.length-1]*=i[i.length-1],i[i.length-1]/=6,i[i.length-1]=Math.sqrt(i[i.length-1]),g[g.length-1]*=g[g.length-1],g[g.length-1]/=6,g[g.length-1]=Math.sqrt(g[g.length-1]),n[s-1][c-1]=i[i.length-1]?g[g.length-1]/i[i.length-1]:null,d[s-1][c-1]=g[g.length-1]?i[i.length-1]/g[g.length-1]:null,u.push({playerFactor:n[s-1][c-1],opponentFactor:d[s-1][c-1],normPlayerFactor:null,normOpponentFactor:null,weight:null,row:s,column:c})):r[s-1][c-1]=l[s][c]}return s=setupMovesReturn(u),s}function getSemiBestMoves(e,l,t,a){let o=e%2+1,r=[],n=[],d=[],u=[],s=[];for(let i=1;i<=indexValues.length;i++){n.push([]),d.push([]),r.push([]);for(let g=1;g<=indexValues.length;g++)n[i-1].push(null),d[i-1].push(null),r[i-1].push(null),null==l[i][g]?(u.push(evaluateMoveDeltas(i,g,e,t)),s.push(evaluateMoveDeltas(i,g,o,a)),u[u.length-1]*=u[u.length-1],u[u.length-1]/=6,u[u.length-1]=Math.sqrt(u[u.length-1]),s[s.length-1]*=s[s.length-1],s[s.length-1]/=6,s[s.length-1]=Math.sqrt(s[s.length-1]),n[i-1][g-1]=u[u.length-1]?s[s.length-1]/u[u.length-1]:null,d[i-1][g-1]=s[s.length-1]?u[u.length-1]/s[s.length-1]:null):r[i-1][g-1]=l[i][g]}return defensiveMoves=setupMovesReturn(getDefensiveMoves(e,r,n,d)),defensiveMoves}